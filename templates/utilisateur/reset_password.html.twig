<!DOCTYPE html>
<html lang="fr">
<!-- [Head] start -->

<head>
  <title>Réinitialisation du mot de passe | Mantis Bootstrap 5 Admin Template</title>
  <!-- [Meta] -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Mantis est conçu avec le framework Bootstrap 5. Téléchargez le modèle d'administration gratuit et utilisez-le pour votre projet.">
  <meta name="keywords" content="Mantis, Tableau de bord, Bootstrap 5, Modèle d'administration, CRM, CMS, Modèle Bootstrap">
  <meta name="author" content="CodedThemes">

  <!-- [Favicon] icon -->
  <link rel="icon" href="images/favicon.svg" type="image/x-icon">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" id="main-font-link">
  <link rel="stylesheet" href="fonts/tabler-icons.min.css">
  <link rel="stylesheet" href="fonts/feather.css">
  <link rel="stylesheet" href="fonts/fontawesome.css">
  <link rel="stylesheet" href="fonts/material.css">
  <link rel="stylesheet" href="css/style.css" id="main-style-link">
  <link rel="stylesheet" href="css/style-preset.css">
  <style>
    .loading {
      display: none;
      text-align: center;
      margin-top: 10px;
    }
    .password-toggle {
      cursor: pointer;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    .password-strength .progress {
      height: 5px;
      margin-top: 5px;
    }
    .input-group .form-control {
      border-right: 0;
    }
    .input-group .btn {
      border-left: 0;
    }
  </style>
</head>
<!-- [Head] end -->
<!-- [Body] Start -->

<body class="auth-main">
  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
      <div class="row">
        <div class="col-12">
          <div class="auth-wrapper v3">
            <div class="auth-form">
              <div class="card my-5">
                <div class="card-body">
                  <div class="text-center">
                    <a href="#"><img src="images/logo-dark.svg" alt="img" class="img-fluid mb-4"></a>
                  </div>
                  <div class="d-flex justify-content-between align-items-end mb-4">
                    <h3 class="mb-0"><b>Réinitialisation du mot de passe</b></h3>
                    <p class="mb-0">Retour à la <a href="{{ path('app_login') }}" class="text-primary">connexion</a></p>
                  </div>
                  
                  {% for message in app.flashes('success') %}
                    <div class="alert alert-success d-flex align-items-center" role="alert">
                      <i class="fas fa-check-circle me-2"></i>
                      <div>{{ message }}</div>
                    </div>
                  {% endfor %}

                  {% for message in app.flashes('error') %}
                    <div class="alert alert-danger d-flex align-items-center" role="alert">
                      <i class="fas fa-exclamation-circle me-2"></i>
                      <div>{{ message }}</div>
                    </div>
                  {% endfor %}

                  <form action="{{ path('app_reset_password', {'token': token}) }}" method="post" id="resetForm">
                    <div class="form-group mb-3">
                      <label for="password" class="form-label">Nouveau mot de passe</label>
                      <div class="input-group">
                        <input type="password" id="password" name="password" class="form-control" 
                               placeholder="Entrez votre nouveau mot de passe" required>
                        <button class="btn btn-light password-toggle" type="button" id="togglePassword">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                      <div class="password-strength mt-2">
                        <small class="text-muted">Force du mot de passe:</small>
                        <div class="progress">
                          <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group mb-3">
                      <label for="confirm_password" class="form-label">Confirmer le mot de passe</label>
                      <div class="input-group">
                        <input type="password" id="confirm_password" name="confirm_password" 
                               class="form-control" placeholder="Confirmez votre nouveau mot de passe" required>
                        <button class="btn btn-light password-toggle" type="button" id="toggleConfirmPassword">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>
                    <div class="d-grid mt-4">
                      <button type="submit" class="btn btn-primary" id="resetButton">Réinitialiser le mot de passe</button>
                    </div>
                    <div class="loading" id="loading">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="auth-footer">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-12">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- [ Main Content ] end -->

  <script src="js/plugins/popper.min.js"></script>
  <script src="js/plugins/simplebar.min.js"></script>
  <script src="js/plugins/bootstrap.min.js"></script>
  <script src="js/fonts/custom-font.js"></script>
  <script src="js/pcoded.js"></script>
  <script src="js/plugins/feather.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const resetForm = document.getElementById('resetForm');
      const loading = document.getElementById('loading');
      const resetButton = document.getElementById('resetButton');

      // Toggle password visibility
      function togglePasswordVisibility(inputId, buttonId) {
        const input = document.getElementById(inputId);
        const button = document.getElementById(buttonId);
        button.addEventListener('click', function() {
          const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
          input.setAttribute('type', type);
          button.querySelector('i').classList.toggle('fa-eye');
          button.querySelector('i').classList.toggle('fa-eye-slash');
        });
      }

      togglePasswordVisibility('password', 'togglePassword');
      togglePasswordVisibility('confirm_password', 'toggleConfirmPassword');

      // Password strength meter
      const passwordInput = document.getElementById('password');
      const strengthMeter = document.querySelector('.password-strength');
      const progressBar = strengthMeter.querySelector('.progress-bar');

      passwordInput.addEventListener('input', function() {
        const strength = calculatePasswordStrength(this.value);
        updateProgressBar(strength);
      });

      function calculatePasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength += 25;
        if (password.match(/[a-z]/)) strength += 25;
        if (password.match(/[A-Z]/)) strength += 25;
        if (password.match(/[0-9]/)) strength += 25;
        return strength;
      }

      function updateProgressBar(strength) {
        progressBar.style.width = strength + '%';
        if (strength < 50) {
          progressBar.className = 'progress-bar bg-danger';
        } else if (strength < 75) {
          progressBar.className = 'progress-bar bg-warning';
        } else {
          progressBar.className = 'progress-bar bg-success';
        }
      }

      // Form submission
      resetForm.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirmPassword = document.getElementById('confirm_password').value;

        if (password !== confirmPassword) {
          e.preventDefault();
          const errorDiv = document.createElement('div');
          errorDiv.className = 'alert alert-danger d-flex align-items-center';
          errorDiv.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i><div>Les mots de passe ne correspondent pas.</div>';
          resetForm.insertBefore(errorDiv, resetForm.firstChild);
          return;
        }

        if (calculatePasswordStrength(password) < 75) {
          e.preventDefault();
          const errorDiv = document.createElement('div');
          errorDiv.className = 'alert alert-danger d-flex align-items-center';
          errorDiv.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i><div>Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre.</div>';
          resetForm.insertBefore(errorDiv, resetForm.firstChild);
          return;
        }

        loading.style.display = 'block';
        resetButton.disabled = true;
      });
    });
  </script>
  
  <script>layout_change('light');</script>
  <script>change_box_container('false');</script>
  <script>layout_rtl_change('false');</script>
  <script>preset_change("preset-1");</script>
  <script>font_change("Public-Sans");</script>
</body>
<!-- [Body] end -->

</html>